# backend_study
> 해당 프로젝트는 2022.01.31~2022.03.30 동안 진행되었으며, 고객센터 상담업무 시스템을 Spring MVC로 개발하는 프로젝트입니다.

<br>

**진행방식**

-   매 Iteration마다 코드리뷰 후 코드를 수정한 뒤, 머지 리퀘스트를 통해 진행됩니다.
-   모든 진행사항은 GitLab을 통해 관리 됩니다.
  -   https://gitlab.com/minju6577346/backend_study   

<br>

**코딩 컨벤션**

- https://github.com/naver/hackday-conventions-java

<br>

**전체 DB 구조**

![image](https://user-images.githubusercontent.com/58619427/154786021-a3393f1c-d515-4fb7-b756-3ec88b705f12.png)

<br>

**기능 요약**

- 상담 카테고리 트리구조 조회 및 통계
- 사용자 등록, 상태변경, 쿠키를 이용한 로그인 관리
- 인터셉터를 이용한 권한 제어
- 상담 건 자동 분배 
- 특정 시간 별 배치잡을 통한 상담 서비스 제어

<br>

# Iteration 1
* 프로젝트 세팅 Spring Web, MyBatis (스프링 부트 사용 금지)
* 선택한 카테고리의 하위 카테고리 리스트를 조회하는 기능을 구현한다. (임의로 root 카테고리를 만들어서 테이블에 넣는다.)
* 전체 카테고리를 트리 구조로 조회하는 기능을 구현한다. ( MySQL/Maria DB에 With Recursive 기능을 사용하여 구현하거나, 카테고리 전체를 조회하여 어플리케이션단에서 트리구조로 변경하는 방식으로 구현한다.)
* 상담을 카테고리에 맞춰 등록하는 기능을 구현한다.
* 사용자 등록 기능을 구현한다. (비밀번호는 단순하게 평문으로 한다. 역할의 기본 값은 상담원으로 한다. 상담원의 id는 유니크한 값이어야 한다.)

<br>

# Iteration 2
* 로그인 기능을 구현한다. 단순하게 비밀번호를 비교해서 로그인 시키도록 한다. 로그인 성공시 단순하게 사용자의 아이디를 쿠키로 발행해준다.
* 상담원이 상담가능 상태로 변경해주는 기능을 구현한다.
* 상담원이 상담불가능한 상태로 변경해주는 기능을 구현한다.
* 카테고리에 속한 매니저는 해당 카테고리에 들어온 문의(담당자가 없는)에 대해 분배 기능을 구현한다. (상담 가능 가능 상담원 중) 분배의 우선 순위는 현재 상담건이 적은 사람을 우선적으로 분배하며, 동일한 조건인 경우 이름순으로 우선 배분된다.
* 상담이 인입될 때 위의 분배 로직과 동일하게 분배될 수 있도록 하며, 상담가능한 상태의 상담원이 없을 시 담당자가 없는 상태로 둔다.
* 카테고리에 매니저 권한이 있는 사용자가 해당 카테고리에 담당자가 없는 상담건의 갯수를 조회하는 기능을 구현한다.

<br>

# Iteration 3
* 문의 답변 기능을 구현한다.
* 로그인 된 사용자 및 매니저 권한이 필요한 기능들에 대해 필터링해주는 인터셉터를 구현한다.
* 쿠키가 존재 시, 사용자 객체를 넣어주는 아규먼트 리졸버를 제공한다.
* Request Body에 해당하는 파라미터들에 대한 유효성 검사하는 기능을 구현한다.
* 실패 건들을 처리할 수 있는 @ControllerAdvice를 구현한다.
<br>

# Iteration 4
* Admin 관련 통계 기능을 구현한다. 요구되는 쿼리 스펙은 아래와 같다. (1)
    * 매니저 권한을 가진 사용자만 조회 가능하다.
    * 조회 조건 : 시작일, 끝일 (시작일과 끝일의 차이는 30일을 넘지 않는다.), 카테고리 ID
    * 조회 조건에 맞는 기간 동안 해당 카테고리에 일자 별 문의 인입 건수, 문의 지연 건수, 정상 처리 건수를 조회한다.
    * 문의가 인입되고 나서 하루 이내에 처리된 건에 대하여 정상 처리되었다고 정의한다.
    * 쿼리 결과 예시 


* Admin 관련 통계 기능을 구현한다. 요구되는 쿼리 스펙은 아래와 같다. (2)
    * 매니저 권한을 가진 사용자만 조회 가능하다.
    * 조회 조건 : 시작일, 끝일 (시작일과 끝일의 차이는 30일을 넘지 않는다.), 카테고리 ID
    * 조회 조건에 맞는 기간 동안 카테고리에 속한 상담원들의 문의 처리 건수, 문의 지연 건수, 정상 처리 건수를 조회한다.
    * 정상 처리 건수가 많은 상담원 순으로 정렬한다.
* 매일 19:00가 되면 모든 활동 중인 사용자들의 상태를 상담 불가능 상태로 변경하는 배치 잡을 구현한다.
    * 수동으로 테스트 할 수 있도록 jobName을 입력 받으면 배치를 돌려줄 수 있는 컨트롤러를 만든다.
* 상담이 인입된 후 3일이 지나도록 담당자가 없는 건들에 대하여 특정 카테고리(상담 지연 카테고리를 임의로 생성)로 옮기는 배치 잡을 구현한다.
    * 배치 잡은 한시간 간격으로 동작한다.

<br>
