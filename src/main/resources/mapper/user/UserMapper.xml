<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.backend.study.user.mapper.UserMapper">

    <insert id="insertUser" parameterType="com.backend.study.user.dto.UserDTO">
        INSERT INTO user
            (id, name, password, role, status, use_yn, creator_id, modifier_id, created_at, modified_at)
        VALUES
            (#{id}, #{name}, #{password},'COUNSELOR', "IMPOSSIBLE", 'Y', #{creatorId}, #{modifierId}, now(), now())
    </insert>

    <insert id="insertUserHistory" parameterType="com.backend.study.user.dto.UserDTO">
        INSERT INTO user_history
            (user_id, sequence, name, password, role, status, use_yn, creator_id, created_at)
        VALUES
            (#{id},
             (SELECT COUNT(*) FROM user_history userHist WHERE userHist.user_id = #{id}) + 1,
             #{name}, #{password},'COUNSELOR', "IMPOSSIBLE", 'Y', #{creatorId},
             (SELECT modified_at FROM user u WHERE u.id = #{id}))
    </insert>
</mapper>

